#!/bin/bash
#5.x version of gromacs#
#based on gromacs lysozyme tutorial#
#first of all copy the needed files and put them into the work file#

job=24

cp ../../data/*mdp .


# clean up
rm *.log *.out *.err *.gro *.top ./\#*

#echo 15 | stdbuf -o 0 gmx pdb2gmx -f Protein.pdb -o Protein_processed.gro -water spce | tee pdb2gmx.log 
#stdbuf -o 0 and | ... extra#

echo 15 | gmx pdb2gmx \
          -ignh -f Protein.pdb \
          -o Protein_processed.gro -water spce

gmx editconf -f Protein_processed.gro -o Protein_newbox.gro  \
	     -c -d 1.0 -bt cubic

# use gromacs 4. NOTE: check how is it done now
# note: we should use gmx solvate and gmx insert-molecules
#	so, we need to re-read the manual
genbox -cp Protein_newbox.gro  -cs spc216.gro -o Protein_solv.gro \
       -p topol.top


gmx grompp -f ions.mdp -c Protein_solv.gro -p topol.top -o ions.tpr

gmx genion -s ions.tpr -o Protein_solv_ions.gro -p topol.top -pname NA -nname CL -nn 6 <<END
13
END

gmx grompp -f minim.mdp -c Protein_solv_ions.gro -p topol.top -o em.tpr

gmx mdrun -nt $job -v -deffnm em
#Energy minimization not slow#



gmx energy -f em.edr -o potential.xvg <<END
10

END

gmx grompp -f nvt.mdp -c em.gro -p topol.top -o nvt.tpr

gmx mdrun -nt $job -deffnm nvt

gmx energy -f nvt.edr <<END
15

END

gmx grompp -f npt.mdp -c nvt.gro -t nvt.cpt -p topol.top -o npt.tpr

gmx mdrun -nt $job -deffnm npt |& tee npt.out

# > to send different data generated by the program to two separated files#
 


gmx energy -f npt.edr -o pressure.xvg <<END
16

END

gmx energy -f npt.edr -o density.xvg <<END
22

END

#equilibration#



gmx grompp -f md.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0-10ns.tpr

gmx mdrun -nt $job -deffnm md_0-10ns

# gmx mdrun -deffnm md_0-10ns -nb gpu use this command to run it in a GPU#

#molecular dynamic#




gmx trjconv -s md_0-10ns.tpr -f md_0-10ns.xtc -o md_0-10ns_noPBC.xtc -pbc mol -ur compact <<END
0

0

END

#system
gmx trjconv -s md_0-10ns.tpr -f md_0-10ns.xtc -o md_0-10ns_noPBC.xtc -pbc mol -ur compact <<END
1

1

END

#protein
gmx rms -s md_0-10ns.tpr -f md_0-10ns_noPBC.xtc -o rmsd.xvg -tu ns <<END
4

4

END
#backbone

gmx rms -s em.tpr -f md_0-10ns_noPBC.xtc -o rmsd_xtal.xvg -tu ns <<END
0

0

END
#System

gmx rms -s em.tpr -f md_0-10ns_noPBC.xtc -o rmsd_xtal.xvg -tu ns <<END
1

1

END
#protein

gmx gyrate -s md_0-10ns.tpr -f md_0-10ns_noPBC.xtc -o gyrate.xvg <<END
0

0

END
#system

gmx gyrate -s md_0-10ns.tpr -f md_0-10ns_noPBC.xtc -o gyrate.xvg <<END
1

1

END
#protein

#analysis#










